<openerp>
<data>
        <!-- ADD DRIVER'S LICENSES TO EMPLOYEES FORM VIEW -->
        <record model="ir.ui.view" id="driver_license_employee_form_view">
            <field name="name">fleet.driver.license.employee.form</field>
            <field name="model">hr.employee</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="TMS_INVD.view_employee_form_tms"/>
            <field name="arch" type="xml">

            	<xpath position="after" expr="//field[@name='tms_category']">
                    <field name="driver_license_ids" attrs="{'invisible':[('tms_category','!=','driver')]}" >
                        <tree editable="top">
                            <field name="name"/>
                            <field name="category"/>
                            <field name="date_in"/>
                            <field name="date_out"/>
                        </tree>
                    </field>      
                </xpath>

            </field>
        </record>

        <!-- ADD DRIVER'S LICENSES CATEGORIES TO VEHICLE FORM VIEW -->
        <record model="ir.ui.view" id="driver_license_vehicle_form_view">
            <field name="name">fleet.driver.license.vehicle.form</field>
            <field name="model">fleet.vehicle</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="fleet_management.fleet_vehicle_form_inherit_job"/>
            <field name="arch" type="xml">

            	<xpath position="after" expr="//page[@string='Parameters']">
                        <page string="Driver's Licence Categories">
                            <group><field name="driver_license_category_ids" widget="many2many_tags"/></group>
                        </page> 
                </xpath>

            </field>
        </record>

        <!-- ADD RESTRICTIONS TO DRIVERS AFFECTED TO A VEHICLE -->
        <record model="ir.ui.view" id="fleet_driver_vehicle_form_view">
            <field name="name">fleet.driver.vehicle.form</field>
            <field name="model">fleet.vehicle</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="TMS_INVD.fleet_vehicle_form_inherit_tms"/>
            <field name="arch" type="xml">

            	<xpath position="replace" expr="//field[@name='employee_id']">
                     <field name="employee_id" context="{'default_tms_category':'driver', 'driver_license_category_ids': driver_license_category_ids}" domain="[('tms_category', '=', 'driver')]"/>
                </xpath>

            </field>
        </record>

        <!-- Action+menuitem of driver's license categories -->
    <!-- Fiche deblocage Tree View -->
        <record model="ir.ui.view" id="view_driver_license_category_tree">
            <field name="name">driver.license.category.tree</field>
            <field name="model">driver.license.category</field>
            <field name="arch" type="xml">
                <tree string="Driver's license categories" editable="top" >
                        <field name="name"/>
                </tree>
            </field>
        </record>


    <record model="ir.actions.act_window" id="action_driver_license_categ">
        <field name="name">Driver's License Categories</field>
        <field name="res_model">driver.license.category</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>

        <menuitem name="Driver's License Categories" parent="fleet.fleet_configuration"
             action="action_driver_license_categ" id="menu_driver_license_categ" sequence="110"/>

    <!-- Message subtype for driver's license cron -->
    <record id="mt_license_expired" model="mail.message.subtype">
        <field name="name">Driver's license is expired</field>
        <field name="res_model">driver.license</field>
        <field name="default" eval="False"/>
        <field name="description">Driver's license is expired</field>
    </record>
    
    <!-- VERIFY DRIVERS AFFECTED TO A KIT -->
        <record model="ir.ui.view" id="unit_kit_inherited_form_view">
            <field name="name">unit.kit.inherited.from</field>
            <field name="model">tms.unit.kit</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="TMS_INVD.view_tms_unit_kit_form"/>
            <field name="arch" type="xml">

            	<xpath position="replace" expr="//field[@name='employee_id']">
                     <field name="employee_id" context="{'default_tms_category':'driver', 'unit_id':unit_id,'trailer1_id': trailer1_id}" domain="[('tms_category', '=', 'driver')]"/>
                </xpath>

            	<xpath position="after" expr="//field[@name='employee_id']">
                    <newline/>
                     <!--<field name="driver_license_category_ids" widget="many2many_tags"/>-->
                </xpath>

            </field>
        </record>

    <!-- VERIFY DRIVERS AFFECTED TO A TRAVEL -->
        <record model="ir.ui.view" id="license_tms_travel_inherited_form_view">
            <field name="name">license.tms.travel.inherited.from</field>
            <field name="model">tms.travel</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="TMS_INVD.view_tms_travel_form"/>
            <field name="arch" type="xml">

            	<xpath position="replace" expr="//field[@name='employee_id']">
                     <field name="employee_id" context="{'default_tms_category':'driver', 'unit_id': unit_id,  'trailer1_id': trailer1_id}" domain="[('tms_category', '=', 'driver')]"/>
                </xpath>

            </field>
        </record>

</data>
</openerp>
